WITH poopoo AS (
SELECT name, COUNT(DISTINCT order_id), COUNT(DISTINCT delivered_to)
FROM order_items
LEFT JOIN orders
ON orders.id = order_items.id
GROUP BY name
  )
SELECT name, ROUND(COUNT(DISTINCT delivered_to) / COUNT(DISTINCT order_id) * 100, 2) AS pct 
FROM poopoo
GROUP BY name;
  
